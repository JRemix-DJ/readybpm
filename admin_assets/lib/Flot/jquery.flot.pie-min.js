!function(M){var O=10,R=.95;function e(P){var t=null,w=null,k=null,A=null,y=null,m=null,o=!1,I=null,p=[];function a(e,i,s){o||(o=!0,t=e.getCanvas(),w=M(t).parent(),k=e.getOptions(),e.setData(r(e.getData())))}function r(e){for(var i=0,s=0,t=0,r=k.series.pie.combine.color,a=[],l=0;l<e.length;++l){var n=e[l].data;M.isArray(n)&&1==n.length&&(n=n[0]),M.isArray(n)?!isNaN(parseFloat(n[1]))&&isFinite(n[1])?n[1]=+n[1]:n[1]=0:n=!isNaN(parseFloat(n))&&isFinite(n)?[1,+n]:[1,0],e[l].data=[n]}for(var l=0;l<e.length;++l)i+=e[l].data[0][1];for(var l=0;l<e.length;++l){var n;(n=e[l].data[0][1])/i<=k.series.pie.combine.threshold&&(s+=n,t++,r||(r=e[l].color))}for(var l=0;l<e.length;++l){var n=e[l].data[0][1];(t<2||n/i>k.series.pie.combine.threshold)&&a.push(M.extend(e[l],{data:[[1,n]],color:e[l].color,label:e[l].label,angle:n*Math.PI*2/i,percent:n/(i/100)}))}return 1<t&&a.push({data:[[1,s]],color:r,label:k.series.pie.combine.label,angle:s*Math.PI*2/i,percent:s/(i/100)}),a}function l(e,i){if(w){var v=e.getPlaceholder().width(),b=e.getPlaceholder().height(),s=w.children().filter(".legend").children().width()||0;I=i,o=!1,A=Math.min(v,b/k.series.pie.tilt)/2,m=b/2+k.series.pie.offset.top,y=v/2,"auto"==k.series.pie.offset.left?(k.legend.position.match("w")?y+=s/2:y-=s/2,y<A?y=A:v-A<y&&(y=v-A)):y+=k.series.pie.offset.left;for(var l=e.getData(),t=0;0<t&&(A*=R),t+=1,r(),k.series.pie.tilt<=.8&&a(),!n()&&t<O;);O<=t&&(r(),w.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")),e.setSeries&&e.insertLegend&&(e.setSeries(l),e.insertLegend())}function r(){I.clearRect(0,0,v,b),w.children().filter(".pieLabel, .pieLabelBackground").remove()}function a(){var e=k.series.pie.shadow.left,i=k.series.pie.shadow.top,s=10,t=k.series.pie.shadow.alpha,r=1<k.series.pie.radius?k.series.pie.radius:A*k.series.pie.radius;if(!(v/2-e<=r||r*k.series.pie.tilt>=b/2-i||r<=10)){I.save(),I.translate(e,i),I.globalAlpha=t,I.fillStyle="#000",I.translate(y,m),I.scale(1,k.series.pie.tilt);for(var a=1;a<=10;a++)I.beginPath(),I.arc(0,0,r,0,2*Math.PI,!1),I.fill(),r-=a;I.restore()}}function n(){var t=Math.PI*k.series.pie.startAngle,r=1<k.series.pie.radius?k.series.pie.radius:A*k.series.pie.radius;I.save(),I.translate(y,m),I.scale(1,k.series.pie.tilt),I.save();for(var a=t,e=0;e<l.length;++e)l[e].startAngle=a,i(l[e].angle,l[e].color,!0);if(I.restore(),0<k.series.pie.stroke.width){I.save(),I.lineWidth=k.series.pie.stroke.width,a=t;for(var e=0;e<l.length;++e)i(l[e].angle,k.series.pie.stroke.color,!1);I.restore()}return h(I),I.restore(),!k.series.pie.label.show||s();function i(e,i,s){e<=0||isNaN(e)||(s?I.fillStyle=i:(I.strokeStyle=i,I.lineJoin="round"),I.beginPath(),1e-9<Math.abs(e-2*Math.PI)&&I.moveTo(0,0),I.arc(0,0,r,a,a+e/2,!1),I.arc(0,0,r,a+e/2,a+e,!1),I.closePath(),a+=e,s?I.fill():I.stroke())}function s(){for(var e=t,f=1<k.series.pie.label.radius?k.series.pie.label.radius:A*k.series.pie.label.radius,i=0;i<l.length;++i){if(l[i].percent>=100*k.series.pie.label.threshold&&!s(l[i],e,i))return!1;e+=l[i].angle}return!0;function s(e,i,s){if(0==e.data[0][1])return!0;var t=k.legend.labelFormatter,r,a=k.series.pie.label.formatter;r=t?t(e.label,e):e.label,a&&(r=a(r,e));var l=(i+e.angle+i)/2,n=y+Math.round(Math.cos(l)*f),o=m+Math.round(Math.sin(l)*f)*k.series.pie.tilt,p="<span class='pieLabel' id='pieLabel"+s+"' style='position:absolute;top:"+o+"px;left:"+n+"px;'>"+r+"</span>";w.append(p);var h=w.children("#pieLabel"+s),g=o-h.height()/2,c=n-h.width()/2;if(h.css("top",g),h.css("left",c),0<0-g||0<0-c||b-(g+h.height())<0||v-(c+h.width())<0)return!1;if(0!=k.series.pie.label.background.opacity){var u=k.series.pie.label.background.color;null==u&&(u=e.color);var d="top:"+g+"px;left:"+c+"px;";M("<div class='pieLabelBackground' style='position:absolute;width:"+h.width()+"px;height:"+h.height()+"px;"+d+"background-color:"+u+";'></div>").css("opacity",k.series.pie.label.background.opacity).insertBefore(h)}return!0}}}}function h(e){if(0<k.series.pie.innerRadius){e.save();var i=1<k.series.pie.innerRadius?k.series.pie.innerRadius:A*k.series.pie.innerRadius;e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=k.series.pie.stroke.color,e.arc(0,0,i,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=k.series.pie.stroke.color,e.arc(0,0,i,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore()}}function x(e,i){for(var s=!1,t=-1,r=e.length,a=r-1;++t<r;a=t)(e[t][1]<=i[1]&&i[1]<e[a][1]||e[a][1]<=i[1]&&i[1]<e[t][1])&&i[0]<(e[a][0]-e[t][0])*(i[1]-e[t][1])/(e[a][1]-e[t][1])+e[t][0]&&(s=!s);return s}function g(e,i){for(var s=P.getData(),t=P.getOptions(),r=1<t.series.pie.radius?t.series.pie.radius:A*t.series.pie.radius,a,l,n=0;n<s.length;++n){var o=s[n];if(o.pie.show){var p,h,g,c,u,d,f,v,b,w,k,M;if(I.save(),I.beginPath(),I.moveTo(0,0),I.arc(0,0,r,o.startAngle,o.startAngle+o.angle/2,!1),I.arc(0,0,r,o.startAngle+o.angle/2,o.startAngle+o.angle,!1),I.closePath(),a=e-y,l=i-m,I.isPointInPath){if(I.isPointInPath(e-y,i-m))return I.restore(),{datapoint:[o.percent,o.data],dataIndex:0,series:o,seriesIndex:n}}else if(x([[0,0],[r*Math.cos(o.startAngle),r*Math.sin(o.startAngle)],[r*Math.cos(o.startAngle+o.angle/4),r*Math.sin(o.startAngle+o.angle/4)],[r*Math.cos(o.startAngle+o.angle/2),r*Math.sin(o.startAngle+o.angle/2)],[r*Math.cos(o.startAngle+o.angle/1.5),r*Math.sin(o.startAngle+o.angle/1.5)],[r*Math.cos(o.startAngle+o.angle),r*Math.sin(o.startAngle+o.angle)]],[a,l]))return I.restore(),{datapoint:[o.percent,o.data],dataIndex:0,series:o,seriesIndex:n};I.restore()}}return null}function n(e){i("plothover",e)}function c(e){i("plotclick",e)}function i(e,i){var s=P.offset(),t,r,a=g(parseInt(i.pageX-s.left),parseInt(i.pageY-s.top));if(k.grid.autoHighlight)for(var l=0;l<p.length;++l){var n=p[l];n.auto!=e||a&&n.series==a.series||d(n.series)}a&&u(a.series,e);var o={pageX:i.pageX,pageY:i.pageY};w.trigger(e,[o,a])}function u(e,i){var s=f(e);-1==s?(p.push({series:e,auto:i}),P.triggerRedrawOverlay()):i||(p[s].auto=!1)}function d(e){null==e&&(p=[],P.triggerRedrawOverlay());var i=f(e);-1!=i&&(p.splice(i,1),P.triggerRedrawOverlay())}function f(e){for(var i=0;i<p.length;++i){var s;if(p[i].series==e)return i}return-1}function v(e,i){var s=e.getOptions(),t=1<s.series.pie.radius?s.series.pie.radius:A*s.series.pie.radius;i.save(),i.translate(y,m),i.scale(1,s.series.pie.tilt);for(var r=0;r<p.length;++r)a(p[r].series);function a(e){e.angle<=0||isNaN(e.angle)||(i.fillStyle="rgba(255, 255, 255, "+s.series.pie.highlight.opacity+")",i.beginPath(),1e-9<Math.abs(e.angle-2*Math.PI)&&i.moveTo(0,0),i.arc(0,0,t,e.startAngle,e.startAngle+e.angle/2,!1),i.arc(0,0,t,e.startAngle+e.angle/2,e.startAngle+e.angle,!1),i.closePath(),i.fill())}h(i),i.restore()}P.hooks.processOptions.push(function(e,i){i.series.pie.show&&(i.grid.show=!1,"auto"==i.series.pie.label.show&&(i.legend.show?i.series.pie.label.show=!1:i.series.pie.label.show=!0),"auto"==i.series.pie.radius&&(i.series.pie.label.show?i.series.pie.radius=.75:i.series.pie.radius=1),1<i.series.pie.tilt?i.series.pie.tilt=1:i.series.pie.tilt<0&&(i.series.pie.tilt=0))}),P.hooks.bindEvents.push(function(e,i){var s=e.getOptions();s.series.pie.show&&(s.grid.hoverable&&i.unbind("mousemove").mousemove(n),s.grid.clickable&&i.unbind("click").click(c))}),P.hooks.processDatapoints.push(function(e,i,s,t){var r;e.getOptions().series.pie.show&&a(e,i,s,t)}),P.hooks.drawOverlay.push(function(e,i){var s;e.getOptions().series.pie.show&&v(e,i)}),P.hooks.draw.push(function(e,i){var s;e.getOptions().series.pie.show&&l(e,i)})}var i={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(e,i){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+i.color+";'>"+e+"<br/>"+Math.round(i.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};M.plot.plugins.push({init:e,options:i,name:"pie",version:"1.1"})}(jQuery);