$.fn.sparkline.box=box=createClass($.fn.sparkline._base,{type:"box",init:function(t,e,r,i,a){box._super.init.call(this,t,e,r,i,a),this.values=$.map(e,Number),this.width="auto"===r.get("width")?"4.0em":i,this.initTarget(),this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var t=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return void 0!==this.loutlier&&t.push({field:"lo",value:this.loutlier}),void 0!==this.routlier&&t.push({field:"ro",value:this.routlier}),void 0!==this.lwhisker&&t.push({field:"lw",value:this.lwhisker}),void 0!==this.rwhisker&&t.push({field:"rw",value:this.rwhisker}),t},render:function(){var t=this.target,e=this.values,r=e.length,i=this.options,a=this.canvasWidth,o=this.canvasHeight,n=void 0===i.get("chartRangeMin")?Math.min.apply(Math,e):i.get("chartRangeMin"),h=void 0===i.get("chartRangeMax")?Math.max.apply(Math,e):i.get("chartRangeMax"),l=0,u,d,s,g,M,p,w,v,c,f,C;if(box._super.render.call(this)){if(i.get("raw"))i.get("showOutliers")&&5<e.length?(d=e[0],u=e[1],g=e[2],M=e[3],p=e[4],w=e[5],v=e[6]):(u=e[0],g=e[1],M=e[2],p=e[3],w=e[4]);else if(e.sort(function(t,e){return t-e}),g=quartile(e,1),M=quartile(e,2),s=(p=quartile(e,3))-g,i.get("showOutliers")){for(u=w=void 0,c=0;c<r;c++)void 0===u&&e[c]>g-s*i.get("outlierIQR")&&(u=e[c]),e[c]<p+s*i.get("outlierIQR")&&(w=e[c]);d=e[0],v=e[r-1]}else u=e[0],w=e[r-1];this.quartiles=[g,M,p],this.lwhisker=u,this.rwhisker=w,this.loutlier=d,this.routlier=v,C=a/(h-n+1),i.get("showOutliers")&&(l=Math.ceil(i.get("spotRadius")),C=(a-=2*Math.ceil(i.get("spotRadius")))/(h-n+1),d<u&&t.drawCircle((d-n)*C+l,o/2,i.get("spotRadius"),i.get("outlierLineColor"),i.get("outlierFillColor")).append(),w<v&&t.drawCircle((v-n)*C+l,o/2,i.get("spotRadius"),i.get("outlierLineColor"),i.get("outlierFillColor")).append()),t.drawRect(Math.round((g-n)*C+l),Math.round(.1*o),Math.round((p-g)*C),Math.round(.8*o),i.get("boxLineColor"),i.get("boxFillColor")).append(),t.drawLine(Math.round((u-n)*C+l),Math.round(o/2),Math.round((g-n)*C+l),Math.round(o/2),i.get("lineColor")).append(),t.drawLine(Math.round((u-n)*C+l),Math.round(o/4),Math.round((u-n)*C+l),Math.round(o-o/4),i.get("whiskerColor")).append(),t.drawLine(Math.round((w-n)*C+l),Math.round(o/2),Math.round((p-n)*C+l),Math.round(o/2),i.get("lineColor")).append(),t.drawLine(Math.round((w-n)*C+l),Math.round(o/4),Math.round((w-n)*C+l),Math.round(o-o/4),i.get("whiskerColor")).append(),t.drawLine(Math.round((M-n)*C+l),Math.round(.1*o),Math.round((M-n)*C+l),Math.round(.9*o),i.get("medianColor")).append(),i.get("target")&&(f=Math.ceil(i.get("spotRadius")),t.drawLine(Math.round((i.get("target")-n)*C+l),Math.round(o/2-f),Math.round((i.get("target")-n)*C+l),Math.round(o/2+f),i.get("targetColor")).append(),t.drawLine(Math.round((i.get("target")-n)*C+l-f),Math.round(o/2),Math.round((i.get("target")-n)*C+l+f),Math.round(o/2),i.get("targetColor")).append()),t.render()}}});