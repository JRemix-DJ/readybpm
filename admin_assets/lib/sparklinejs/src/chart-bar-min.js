$.fn.sparkline.bar=bar=createClass($.fn.sparkline._base,barHighlightMixin,{type:"bar",init:function(t,a,i,e,h){var l=parseInt(i.get("barWidth"),10),r=parseInt(i.get("barSpacing"),10),s=i.get("chartRangeMin"),n=i.get("chartRangeMax"),o=i.get("chartRangeClip"),g=1/0,c=-1/0,p,M,u,f,d,v,y,x,C,R,b,B,m,H,V,k,A,W,z,I,w,E,O;for(bar._super.init.call(this,t,a,i,e,h),v=0,y=a.length;v<y;v++)((p="string"==typeof(I=a[v])&&-1<I.indexOf(":"))||$.isArray(I))&&(V=!0,p&&(I=a[v]=normalizeValues(I.split(":"))),I=remove(I,null),(M=Math.min.apply(Math,I))<g&&(g=M),c<(u=Math.max.apply(Math,I))&&(c=u));this.stacked=V,this.regionShapes={},this.barWidth=l,this.barSpacing=r,this.totalBarWidth=l+r,this.width=e=a.length*l+(a.length-1)*r,this.initTarget(),o&&(m=void 0===s?-1/0:s,H=void 0===n?1/0:n),d=[],f=V?[]:d;var S=[],_=[];for(v=0,y=a.length;v<y;v++)if(V)for(k=a[v],a[v]=z=[],S[v]=0,f[v]=_[v]=0,A=0,W=k.length;A<W;A++)null!==(I=z[A]=o?clipval(k[A],m,H):k[A])&&(0<I&&(S[v]+=I),g<0&&0<c?I<0?_[v]+=Math.abs(I):f[v]+=I:f[v]+=Math.abs(I-(I<0?c:g)),d.push(I));else I=o?clipval(a[v],m,H):a[v],null!==(I=a[v]=normalizeValue(I))&&d.push(I);this.max=B=Math.max.apply(Math,d),this.min=b=Math.min.apply(Math,d),this.stackMax=c=V?Math.max.apply(Math,S):B,this.stackMin=g=V?Math.min.apply(Math,d):b,void 0!==i.get("chartRangeMin")&&(i.get("chartRangeClip")||i.get("chartRangeMin")<b)&&(b=i.get("chartRangeMin")),void 0!==i.get("chartRangeMax")&&(i.get("chartRangeClip")||i.get("chartRangeMax")>B)&&(B=i.get("chartRangeMax")),this.zeroAxis=C=i.get("zeroAxis",!0),R=b<=0&&0<=B&&C?0:0==C?b:0<b?b:B,this.xaxisOffset=R,x=V?Math.max.apply(Math,f)+Math.max.apply(Math,_):B-b,this.canvasHeightEf=C&&b<0?this.canvasHeight-2:this.canvasHeight-1,b<R?(w=((E=V&&0<=B?c:B)-R)/x*this.canvasHeight)!==Math.ceil(w)&&(this.canvasHeightEf-=2,w=Math.ceil(w)):w=this.canvasHeight,this.yoffset=w,$.isArray(i.get("colorMap"))?(this.colorMapByIndex=i.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=i.get("colorMap"),this.colorMapByValue&&void 0===this.colorMapByValue.get&&(this.colorMapByValue=new RangeMap(this.colorMapByValue))),this.range=x},getRegion:function(t,a,i){var e=Math.floor(a/this.totalBarWidth);return e<0||e>=this.values.length?void 0:e},getCurrentRegionFields:function(){var t=this.currentRegion,a=ensureArray(this.values[t]),i=[],e,h;for(h=a.length;h--;)e=a[h],i.push({isNull:null===e,value:e,color:this.calcColor(h,e,t),offset:t});return i},calcColor:function(t,a,i){var e=this.colorMapByIndex,h=this.colorMapByValue,l=this.options,r,s;return r=this.stacked?l.get("stackedBarColor"):a<0?l.get("negBarColor"):l.get("barColor"),0===a&&void 0!==l.get("zeroColor")&&(r=l.get("zeroColor")),h&&(s=h.get(a))?r=s:e&&e.length>i&&(r=e[i]),$.isArray(r)?r[t%r.length]:r},renderRegion:function(t,a){var i=this.values[t],e=this.options,h=this.xaxisOffset,l=[],r=this.range,s=this.stacked,n=this.target,o=t*this.totalBarWidth,g=this.canvasHeightEf,c=this.yoffset,p,M,u,f,d,v,y,x,C,R;if(y=(i=$.isArray(i)?i:[i]).length,x=i[0],f=all(null,i),R=all(h,i,!0),f)return e.get("nullColor")?(u=a?e.get("nullColor"):this.calcHighlightColor(e.get("nullColor"),e),p=0<c?c-1:c,n.drawRect(o,p,this.barWidth-1,0,u,u)):void 0;for(d=c,v=0;v<y;v++){if(x=i[v],s&&x===h){if(!R||C)continue;C=!0}M=0<r?Math.floor(g*(Math.abs(x-h)/r))+1:1,x<h||x===h&&0===c?(p=d,d+=M):(p=c-M,c-=M),u=this.calcColor(v,x,t),a&&(u=this.calcHighlightColor(u,e)),l.push(n.drawRect(o,p,this.barWidth-1,M-1,u,u))}return 1===l.length?l[0]:l}});