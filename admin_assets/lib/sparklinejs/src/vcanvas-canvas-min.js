VCanvas_canvas=createClass(VCanvas_base,{init:function(t,e,i,s){VCanvas_canvas._super.init.call(this,t,e,i),this.canvas=document.createElement("canvas"),i[0]&&(i=i[0]),$.data(i,"_jqs_vcanvas",this),$(this.canvas).css({display:"inline-block",width:t,height:e,verticalAlign:"top"}),this._insert(this.canvas,i),this._calculatePixelDims(t,e,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,this.interact=s,this.shapes={},this.shapeseq=[],this.currentTargetShapeId=void 0,$(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(t,e,i){var s=this.canvas.getContext("2d");return void 0!==t&&(s.strokeStyle=t),s.lineWidth=void 0===i?1:i,void 0!==e&&(s.fillStyle=e),s},reset:function(){var t;this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight),this.shapes={},this.shapeseq=[],this.currentTargetShapeId=void 0},_drawShape:function(t,e,i,s,h){var a=this._getContext(i,s,h),n,r;for(a.beginPath(),a.moveTo(e[0][0]+.5,e[0][1]+.5),n=1,r=e.length;n<r;n++)a.lineTo(e[n][0]+.5,e[n][1]+.5);void 0!==i&&a.stroke(),void 0!==s&&a.fill(),void 0!==this.targetX&&void 0!==this.targetY&&a.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=t)},_drawCircle:function(t,e,i,s,h,a,n){var r=this._getContext(h,a,n);r.beginPath(),r.arc(e,i,s,0,2*Math.PI,!1),void 0!==this.targetX&&void 0!==this.targetY&&r.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=t),void 0!==h&&r.stroke(),void 0!==a&&r.fill()},_drawPieSlice:function(t,e,i,s,h,a,n,r){var o=this._getContext(n,r);o.beginPath(),o.moveTo(e,i),o.arc(e,i,s,h,a,!1),o.lineTo(e,i),o.closePath(),void 0!==n&&o.stroke(),r&&o.fill(),void 0!==this.targetX&&void 0!==this.targetY&&o.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=t)},_drawRect:function(t,e,i,s,h,a,n){return this._drawShape(t,[[e,i],[e+s,i],[e+s,i+h],[e,i+h],[e,i]],a,n)},appendShape:function(t){return this.shapes[t.id]=t,this.shapeseq.push(t.id),this.lastShapeId=t.id,t.id},replaceWithShape:function(t,e){var i=this.shapeseq,s;for(this.shapes[e.id]=e,s=i.length;s--;)i[s]==t&&(i[s]=e.id);delete this.shapes[t]},replaceWithShapes:function(t,e){var i=this.shapeseq,s={},h,a,n;for(a=t.length;a--;)s[t[a]]=!0;for(a=i.length;a--;)s[h=i[a]]&&(i.splice(a,1),delete this.shapes[h],n=a);for(a=e.length;a--;)i.splice(n,0,e[a].id),this.shapes[e[a].id]=e[a]},insertAfterShape:function(t,e){var i=this.shapeseq,s;for(s=i.length;s--;)if(i[s]===t)return i.splice(s+1,0,e.id),void(this.shapes[e.id]=e)},removeShapeId:function(t){var e=this.shapeseq,i;for(i=e.length;i--;)if(e[i]===t){e.splice(i,1);break}delete this.shapes[t]},getShapeAt:function(t,e,i){return this.targetX=e,this.targetY=i,this.render(),this.currentTargetShapeId},render:function(){var t=this.shapeseq,e=this.shapes,i=t.length,s,h,a,n;for(this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight),n=0;n<i;n++)this["_draw"+(a=e[h=t[n]]).type].apply(this,a.args);this.interact||(this.shapes={},this.shapeseq=[])}});