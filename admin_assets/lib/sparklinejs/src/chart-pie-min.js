$.fn.sparkline.pie=pie=createClass($.fn.sparkline._base,{type:"pie",init:function(t,e,i,s,h){var r=0,a;if(pie._super.init.call(this,t,e,i,s,h),this.shapes={},this.valueShapes={},this.values=e=$.map(e,Number),"auto"===i.get("width")&&(this.width=this.height),0<e.length)for(a=e.length;a--;)r+=e[a];this.total=r,this.initTarget(),this.radius=Math.floor(Math.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(t,e,i){var s=this.target.getShapeAt(t,e,i);return void 0!==s&&void 0!==this.shapes[s]?this.shapes[s]:void 0},getCurrentRegionFields:function(){var t=this.currentRegion;return{isNull:void 0===this.values[t],value:this.values[t],percent:this.values[t]/this.total*100,color:this.options.get("sliceColors")[t%this.options.get("sliceColors").length],offset:t}},changeHighlight:function(t){var e=this.currentRegion,i=this.renderSlice(e,t),s=this.valueShapes[e];delete this.shapes[s],this.target.replaceWithShape(s,i),this.valueShapes[e]=i.id,this.shapes[i.id]=e},renderSlice:function(t,e){var i=this.target,s=this.options,h=this.radius,r=s.get("borderWidth"),a=s.get("offset"),o=2*Math.PI,l=this.values,n=this.total,g=a?2*Math.PI*(a/360):0,d,p,u,c,v;for(c=l.length,u=0;u<c;u++){if(p=d=g,0<n&&(p=g+o*(l[u]/n)),t===u)return v=s.get("sliceColors")[u%s.get("sliceColors").length],e&&(v=this.calcHighlightColor(v,s)),i.drawPieSlice(h,h,h-r,d,p,void 0,v);g=p}},render:function(){var t=this.target,e=this.values,i=this.options,s=this.radius,h=i.get("borderWidth"),r,a;if(pie._super.render.call(this)){for(h&&t.drawCircle(s,s,Math.floor(s-h/2),i.get("borderColor"),void 0,h).append(),a=e.length;a--;)e[a]&&(r=this.renderSlice(a).append(),this.valueShapes[a]=r.id,this.shapes[r.id]=a);t.render()}}});