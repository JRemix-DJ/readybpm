initStyles=function(){addCSS(defaultStyles)},$(initStyles),pending=[],$.fn.sparkline=function(l,e){return this.each(function(){var a=new $.fn.sparkline.options(this,e),g=$(this),t,i;if(t=function(){var t,i,e,n,s,r,h;t="html"===l||void 0===l?(null==(h=this.getAttribute(a.get("tagValuesAttribute")))&&(h=g.html()),h.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")):l,i="auto"===a.get("width")?t.length*a.get("defaultPixelsPerValue"):a.get("width"),"auto"===a.get("height")?a.get("composite")&&$.data(this,"_jqs_vcanvas")||((n=document.createElement("span")).innerHTML="a",g.html(n),e=$(n).innerHeight()||$(n).height(),$(n).remove(),n=null):e=a.get("height"),a.get("disableInteraction")?s=!1:(s=$.data(this,"_jqs_mhandler"))?a.get("composite")||s.reset():(s=new MouseHandler(this,a),$.data(this,"_jqs_mhandler",s)),!a.get("composite")||$.data(this,"_jqs_vcanvas")?((r=new($.fn.sparkline[a.get("type")])(this,t,a,i,e)).render(),s&&s.registerSparkline(r)):$.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),$.data(this,"_jqs_errnotify",!0))},$(this).html()&&!a.get("disableHiddenCheck")&&$(this).is(":hidden")||!$(this).parents("body").length){if(!a.get("composite")&&$.data(this,"_jqs_pending"))for(i=pending.length;i;i--)pending[i-1][0]==this&&pending.splice(i-1,1);pending.push([this,t]),$.data(this,"_jqs_pending",!0)}else t.call(this)})},$.fn.sparkline.defaults=getDefaults(),$.sparkline_display_visible=function(){var t,i,e,n=[];for(i=0,e=pending.length;i<e;i++)t=pending[i][0],$(t).is(":visible")&&!$(t).parents().is(":hidden")?(pending[i][1].call(t),$.data(pending[i][0],"_jqs_pending",!1),n.push(i)):$(t).closest("html").length||$.data(t,"_jqs_pending")||($.data(pending[i][0],"_jqs_pending",!1),n.push(i));for(i=n.length;i;i--)pending.splice(n[i-1],1)},$.fn.sparkline.options=createClass({init:function(t,i){var e,n,s,r;this.userOptions=i=i||{},this.tag=t,this.tagValCache={},s=(n=$.fn.sparkline.defaults).common,this.tagOptionsPrefix=i.enableTagOptions&&(i.tagOptionsPrefix||s.tagOptionsPrefix),e=(r=this.getTagSetting("type"))===UNSET_OPTION?n[i.type||s.type]:n[r],this.mergedOptions=$.extend({},s,e,i)},getTagSetting:function(t){var i=this.tagOptionsPrefix,e,n,s,r;if(!1===i||void 0===i)return UNSET_OPTION;if(this.tagValCache.hasOwnProperty(t))e=this.tagValCache.key;else{if(null==(e=this.tag.getAttribute(i+t)))e=UNSET_OPTION;else if("["===e.substr(0,1))for(n=(e=e.substr(1,e.length-2).split(",")).length;n--;)e[n]=normalizeValue(e[n].replace(/(^\s*)|(\s*$)/g,""));else if("{"===e.substr(0,1))for(s=e.substr(1,e.length-2).split(","),e={},n=s.length;n--;)e[(r=s[n].split(":",2))[0].replace(/(^\s*)|(\s*$)/g,"")]=normalizeValue(r[1].replace(/(^\s*)|(\s*$)/g,""));else e=normalizeValue(e);this.tagValCache.key=e}return e},get:function(t,i){var e=this.getTagSetting(t),n;return e!==UNSET_OPTION?e:void 0===(n=this.mergedOptions[t])?i:n}}),$.fn.sparkline._base=createClass({disabled:!1,init:function(t,i,e,n,s){this.el=t,this.$el=$(t),this.values=i,this.options=e,this.width=n,this.height=s,this.currentRegion=void 0},initTarget:function(){var t=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),t))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return!this.disabled||(this.el.innerHTML="",!1)},getRegion:function(t,i){},setRegionHighlight:function(t,i,e){var n=this.currentRegion,s=!this.options.get("disableHighlight"),r;return i>this.canvasWidth||e>this.canvasHeight||i<0||e<0?null:n!==(r=this.getRegion(t,i,e))&&(void 0!==n&&s&&this.removeHighlight(),void 0!==(this.currentRegion=r)&&s&&this.renderHighlight(),!0)},clearRegionHighlight:function(){return void 0!==this.currentRegion&&(this.removeHighlight(),!(this.currentRegion=void 0))},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(t){},getCurrentRegionTooltip:function(){var t=this.options,i="",e=[],n,s,r,h,a,g,l,o,p,d,u,f,c,v;if(void 0===this.currentRegion)return"";if(n=this.getCurrentRegionFields(),u=t.get("tooltipFormatter"))return u(this,t,n);if(t.get("tooltipChartTitle")&&(i+='<div class="jqs jqstitle">'+t.get("tooltipChartTitle")+"</div>\n"),!(s=this.options.get("tooltipFormat")))return"";if($.isArray(s)||(s=[s]),$.isArray(n)||(n=[n]),l=this.options.get("tooltipFormatFieldlist"),o=this.options.get("tooltipFormatFieldlistKey"),l&&o){for(p=[],g=n.length;g--;)d=n[g][o],-1!=(v=$.inArray(d,l))&&(p[v]=n[g]);n=p}for(r=s.length,c=n.length,g=0;g<r;g++)for("string"==typeof(f=s[g])&&(f=new SPFormat(f)),h=f.fclass||"jqsfield",v=0;v<c;v++)n[v].isNull&&t.get("tooltipSkipNull")||($.extend(n[v],{prefix:t.get("tooltipPrefix"),suffix:t.get("tooltipSuffix")}),a=f.render(n[v],t.get("tooltipValueLookups"),t),e.push('<div class="'+h+'">'+a+"</div>"));return e.length?i+e.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(t,i){var e=i.get("highlightColor"),n=i.get("highlightLighten"),s,r,h,a;if(e)return e;if(n&&(s=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(t))){for(h=[],r=4===t.length?16:1,a=0;a<3;a++)h[a]=clipval(Math.round(parseInt(s[a+1],16)*r*n),0,255);return"rgb("+h.join(",")+")"}return t}}),barHighlightMixin={changeHighlight:function(t){var i=this.currentRegion,e=this.target,n=this.regionShapes[i],s;n&&(s=this.renderRegion(i,t),$.isArray(s)||$.isArray(n)?(e.replaceWithShapes(n,s),this.regionShapes[i]=$.map(s,function(t){return t.id})):(e.replaceWithShape(n,s),this.regionShapes[i]=s.id))},render:function(){var t=this.values,i=this.target,e=this.regionShapes,n,s,r,h;if(this.cls._super.render.call(this)){for(r=t.length;r--;)if(n=this.renderRegion(r))if($.isArray(n)){for(s=[],h=n.length;h--;)n[h].append(),s.push(n[h].id);e[r]=s}else n.append(),e[r]=n.id;else e[r]=null;i.render()}}};