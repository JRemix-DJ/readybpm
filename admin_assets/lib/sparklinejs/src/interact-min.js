MouseHandler=createClass({init:function(t,i){var s=$(t);this.$el=s,this.options=i,this.currentPageX=0,this.currentPageY=0,this.el=t,this.splist=[],this.tooltip=null,this.over=!1,this.displayTooltips=!i.get("disableTooltips"),this.highlightEnabled=!i.get("disableHighlight")},registerSparkline:function(t){this.splist.push(t),this.over&&this.updateDisplay()},registerCanvas:function(t){var i=$(t.canvas);this.canvas=t,(this.$canvas=i).mouseenter($.proxy(this.mouseenter,this)),i.mouseleave($.proxy(this.mouseleave,this)),i.click($.proxy(this.mouseclick,this))},reset:function(t){this.splist=[],this.tooltip&&t&&(this.tooltip.remove(),this.tooltip=void 0)},mouseclick:function(t){var i=$.Event("sparklineClick");i.originalEvent=t,i.sparklines=this.splist,this.$el.trigger(i)},mouseenter:function(t){$(document.body).unbind("mousemove.jqs"),$(document.body).bind("mousemove.jqs",$.proxy(this.mousemove,this)),this.over=!0,this.currentPageX=t.pageX,this.currentPageY=t.pageY,this.currentEl=t.target,!this.tooltip&&this.displayTooltips&&(this.tooltip=new Tooltip(this.options),this.tooltip.updatePosition(t.pageX,t.pageY)),this.updateDisplay()},mouseleave:function(){$(document.body).unbind("mousemove.jqs");var t=this.splist,i=t.length,s=!1,e,o;for(this.over=!1,this.currentEl=null,this.tooltip&&(this.tooltip.remove(),this.tooltip=null),o=0;o<i;o++)(e=t[o]).clearRegionHighlight()&&(s=!0);s&&this.canvas.render()},mousemove:function(t){this.currentPageX=t.pageX,this.currentPageY=t.pageY,this.currentEl=t.target,this.tooltip&&this.tooltip.updatePosition(t.pageX,t.pageY),this.updateDisplay()},updateDisplay:function(){var t=this.splist,i=t.length,s=!1,e=this.$canvas.offset(),o=this.currentPageX-e.left,h=this.currentPageY-e.top,l,n,p,r,a;if(this.over){for(p=0;p<i;p++)(r=(n=t[p]).setRegionHighlight(this.currentEl,o,h))&&(s=!0);if(s){if((a=$.Event("sparklineRegionChange")).sparklines=this.splist,this.$el.trigger(a),this.tooltip){for(l="",p=0;p<i;p++)l+=(n=t[p]).getCurrentRegionTooltip();this.tooltip.setContent(l)}this.disableHighlight||this.canvas.render()}null===r&&this.mouseleave()}}}),Tooltip=createClass({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(t){var i=t.get("tooltipClassname","jqstooltip"),s=this.sizeStyle,e;this.container=t.get("tooltipContainer")||document.body,this.tooltipOffsetX=t.get("tooltipOffsetX",10),this.tooltipOffsetY=t.get("tooltipOffsetY",12),$("#jqssizetip").remove(),$("#jqstooltip").remove(),this.sizetip=$("<div/>",{id:"jqssizetip",style:s,class:i}),this.tooltip=$("<div/>",{id:"jqstooltip",class:i}).appendTo(this.container),e=this.tooltip.offset(),this.offsetLeft=e.left,this.offsetTop=e.top,this.hidden=!0,$(window).unbind("resize.jqs scroll.jqs"),$(window).bind("resize.jqs scroll.jqs",$.proxy(this.updateWindowDims,this)),this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=$(window).scrollTop(),this.scrollLeft=$(window).scrollLeft(),this.scrollRight=this.scrollLeft+$(window).width(),this.updatePosition()},getSize:function(t){this.sizetip.html(t).appendTo(this.container),this.width=this.sizetip.width()+1,this.height=this.sizetip.height(),this.sizetip.remove()},setContent:function(t){if(!t)return this.tooltip.css("visibility","hidden"),void(this.hidden=!0);this.getSize(t),this.tooltip.html(t).css({width:this.width,height:this.height,visibility:"visible"}),this.hidden&&(this.hidden=!1,this.updatePosition())},updatePosition:function(t,i){if(void 0===t){if(void 0===this.mousex)return;t=this.mousex-this.offsetLeft,i=this.mousey-this.offsetTop}else this.mousex=t-=this.offsetLeft,this.mousey=i-=this.offsetTop;this.height&&this.width&&!this.hidden&&(i-=this.height+this.tooltipOffsetY,t+=this.tooltipOffsetX,i<this.scrollTop&&(i=this.scrollTop),t<this.scrollLeft?t=this.scrollLeft:t+this.width>this.scrollRight&&(t=this.scrollRight-this.width),this.tooltip.css({left:t,top:i}))},remove:function(){this.tooltip.remove(),this.sizetip.remove(),this.sizetip=this.tooltip=void 0,$(window).unbind("resize.jqs scroll.jqs")}});